# Anaf Info App

## Overview
Anaf Info is a full-stack application consisting of an Angular frontend and a Spring Boot backend. The backend provides business logic and data storage, while the frontend delivers a modern user interface. The project is containerized using Docker for easy deployment and scalability.

## Architecture
- **Frontend:** Angular (served via Nginx)
- **Backend:** Java Spring Boot
- **Database:** SQLite (file-based, included in backend container)
- **PDF Storage:** Mounted volume for persistent PDF and metadata storage
- **Container Orchestration:** Docker Compose

## Prerequisites
- [Docker](https://www.docker.com/get-started) (v20+ recommended)
- [Docker Compose](https://docs.docker.com/compose/)

## Getting Started

### 1. Clone the Repository
```sh
git clone https://github.com/AndraB04/anaf_info_app.git
cd Softnet_Anaf_Info
```

### 2. Build and Start the Application
Build and run both frontend and backend containers using Docker Compose:
```sh
docker-compose up --build
```
- The backend will be available at `http://localhost:8080`
- The frontend will be available at `http://localhost`

### 3. Stopping the Application
To stop the containers:
```sh
docker-compose down
```

## Project Structure
```
softnet-frontend-angular/   # Angular frontend source code
softnet_backend/          # Spring Boot backend source code and database
Dockerfile.frontend       # Dockerfile for frontend
Dockerfile.backend        # Dockerfile for backend
docker-compose.yml        # Multi-container orchestration
```

## Persistent Data
- **PDF files and metadata** are stored in `softnet_backend/pdf-storage` and mounted as a Docker volume.


## Functionalities

### Company Data Retrieval
- Integrates with the official ANAF API to retrieve company details and financial history (bilant).
- Users can search for companies by CUI and view up-to-date information and historical financial data.

### PDF Generation, Metadata, and Storage
- Users can generate PDF reports containing company and financial information.
- Each PDF is stored in `pdf-storage` and is accompanied by a metadata file (with generation timestamp, company data, and checksum).
- The backend signs each PDF and calculates a checksum to ensure integrity.
- The PDF metadata is stored and managed on the server. For additional verification, users can inspect the metadata using tools such as `exiftool` or a hex editor to confirm integrity and authenticity.

### PDF Verification
- The application verifies that a PDF has not been altered by checking its checksum.
- The server also verifies the PDF signature using a secret key, ensuring the PDF was generated by the backend.

### Email Sending with OAuth 2FA
- Users can send generated PDF reports via email.
- Email sending is secured using OAuth 2FA for authentication.
- The application uses the Postmark email service for reliable delivery.

### Database
- The backend uses a SQLite database to persist company search history, PDF generation logs, and user actions.

### Security: CORS Policy and SSRF Protection
- CORS policy is enforced in the backend to allow requests only from the trusted frontend origin (e.g., `http://localhost:4200` during development).
- Example CORS configuration:
	- Only allows requests from the frontend origin.
	- Allows standard HTTP methods and headers.
	- Credentials and preflight requests are supported.
- SSRF (Server-Side Request Forgery) protection is implemented:
	- The backend does not proxy or fetch arbitrary URLs provided by users.
	- All external API calls (e.g., to ANAF) are strictly validated and use whitelisted endpoints only.

## Integrations
- **ANAF API:** For company details and financial history.
- **Postmark:** For sending emails with PDF attachments, supporting OAuth 2FA.
- **PDF Generation:** Server-side PDF creation and signing.
- **Checksum & Signature:** Ensures PDF integrity and authenticity.

## Customization
- To change backend or frontend ports, edit `docker-compose.yml`.
- For backend configuration, modify `application.properties` in `softnet_backend/src/main/resources`.

**Important:** You must add your email password and API tokens (such as for Postmark or OAuth) to the `application.properties` file for the backend to function correctly. Ensure these credentials are kept secure and never committed to version control.
